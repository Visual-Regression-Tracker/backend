# Migration `20210324150944-main-to-feature-test-run-self-relation-added`

This migration has been generated by Pavel Strunkin at 3/24/2021, 5:09:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "TestRun" ADD COLUMN     "mainBranchTestRunId" TEXT

CREATE UNIQUE INDEX "TestRun_mainBranchTestRunId_unique" ON "TestRun"("mainBranchTestRunId")

ALTER TABLE "TestRun" ADD FOREIGN KEY("mainBranchTestRunId")REFERENCES "TestRun"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210228121726-test-run--nullable-test-variation-id..20210324150944-main-to-feature-test-run-self-relation-added
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Build {
   id         String    @id @default(uuid())
@@ -65,8 +65,12 @@
   branchName            String         @default("master")
   baselineBranchName    String?
   ignoreAreas           String         @default("[]")
   tempIgnoreAreas       String         @default("[]")
+  // autoApprove
+  mainBranchTestRunId   String?
+  mainBranchTestRun     TestRun?       @relation("MainToFeatureTestRun", fields: [mainBranchTestRunId], references: [id])
+  featureTestRun        TestRun?       @relation("MainToFeatureTestRun")
 }
 model TestVariation {
   id           String     @id @default(uuid())
```


