# Migration `20200503001556-init`

This migration has been generated by Pavel Strunkin at 5/3/2020, 12:15:56 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "TestStatus" AS ENUM ('failed', 'new', 'ok', 'unresolved');

CREATE TABLE "public"."Build" (
"branchName" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"number" integer   ,"projectId" text  NOT NULL ,"status" text   ,"updatedAt" timestamp(3)  NOT NULL ,"userId" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Project" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."TestRun" (
"buildId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"diffName" text   ,"diffPercent" Decimal(65,30)   ,"diffTollerancePercent" Decimal(65,30)  NOT NULL DEFAULT 1.0,"id" text  NOT NULL ,"imageName" text  NOT NULL ,"pixelMisMatchCount" integer   ,"status" "TestStatus" NOT NULL ,"testVariationId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."TestVariation" (
"baselineName" text   ,"browser" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"device" text   ,"id" text  NOT NULL ,"ignoreAreas" text  NOT NULL DEFAULT '[]',"name" text  NOT NULL ,"os" text   ,"projectId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"viewport" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"apiKey" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"firstName" text   ,"id" text  NOT NULL ,"isActive" boolean  NOT NULL DEFAULT true,"lastName" text   ,"password" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.apiKey" ON "public"."User"("apiKey")

ALTER TABLE "public"."Build" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Build" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."TestRun" ADD FOREIGN KEY ("buildId")REFERENCES "public"."Build"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TestRun" ADD FOREIGN KEY ("testVariationId")REFERENCES "public"."TestVariation"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TestVariation" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200503001556-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,83 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Build {
+  id         String    @default(uuid()) @id
+  number     Int?
+  branchName String?
+  status     String?
+  testRuns   TestRun[]
+  projectId  String
+  project    Project   @relation(fields: [projectId], references: [id])
+  // userId     String
+  // user       User      @relation(fields: [userId], references: [id])
+  updatedAt  DateTime  @updatedAt
+  createdAt  DateTime  @default(now())
+}
+
+model Project {
+  id             String          @default(uuid()) @id
+  name           String
+  builds         Build[]
+  testVariations TestVariation[]
+  updatedAt      DateTime        @updatedAt
+  createdAt      DateTime        @default(now())
+}
+
+model TestRun {
+  id                    String        @default(uuid()) @id
+  imageName             String
+  diffName              String?
+  diffPercent           Float?
+  diffTollerancePercent Float         @default(1.0)
+  pixelMisMatchCount    Int?
+  status                TestStatus
+  buildId               String
+  build                 Build         @relation(fields: [buildId], references: [id])
+  testVariationId       String
+  testVariation         TestVariation @relation(fields: [testVariationId], references: [id])
+  updatedAt             DateTime      @updatedAt
+  createdAt             DateTime      @default(now())
+}
+
+model TestVariation {
+  id           String    @default(uuid()) @id
+  name         String
+  browser      String?
+  device       String?
+  os           String?
+  viewport     String?
+  baselineName String?
+  ignoreAreas  String    @default("[]")
+  projectId    String
+  project      Project   @relation(fields: [projectId], references: [id])
+  testRuns     TestRun[]
+  updatedAt    DateTime  @updatedAt
+  createdAt    DateTime  @default(now())
+}
+
+model User {
+  id        String   @default(uuid()) @id
+  email     String   @unique
+  password  String
+  firstName String?
+  lastName  String?
+  apiKey    String   @unique
+  isActive  Boolean  @default(true)
+  builds    Build[]
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
+enum TestStatus {
+  failed
+  new
+  ok
+  unresolved
+}
```


