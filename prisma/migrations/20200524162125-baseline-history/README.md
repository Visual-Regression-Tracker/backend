# Migration `20200524162125-baseline-history`

This migration has been generated by Pavel Strunkin at 5/24/2020, 4:21:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Baseline" (
"baselineName" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"testRunId" text   ,"testVariationId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."TestRun" ADD COLUMN "baselineName" text   ,
ADD COLUMN "browser" text   ,
ADD COLUMN "device" text   ,
ADD COLUMN "ignoreAreas" text  NOT NULL DEFAULT '[]',
ADD COLUMN "name" text  NOT NULL DEFAULT '',
ADD COLUMN "os" text   ,
ADD COLUMN "viewport" text   ;

CREATE UNIQUE INDEX "Baseline_testRunId" ON "public"."Baseline"("testRunId")

ALTER TABLE "public"."Baseline" ADD FOREIGN KEY ("testVariationId")REFERENCES "public"."TestVariation"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Baseline" ADD FOREIGN KEY ("testRunId")REFERENCES "public"."TestRun"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200503001556-init..20200524162125-baseline-history
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Build {
   id         String    @default(uuid()) @id
@@ -14,12 +14,12 @@
   status     String?
   testRuns   TestRun[]
   projectId  String
   project    Project   @relation(fields: [projectId], references: [id])
-  // userId     String
-  // user       User      @relation(fields: [userId], references: [id])
   updatedAt  DateTime  @updatedAt
   createdAt  DateTime  @default(now())
+  user       User?     @relation(fields: [userId], references: [id])
+  userId     String?
 }
 model Project {
   id             String          @default(uuid()) @id
@@ -43,26 +43,48 @@
   testVariationId       String
   testVariation         TestVariation @relation(fields: [testVariationId], references: [id])
   updatedAt             DateTime      @updatedAt
   createdAt             DateTime      @default(now())
+  // Test variation data
+  name                  String        @default("")
+  browser               String?
+  device                String?
+  os                    String?
+  viewport              String?
+  baselineName          String?
+  ignoreAreas           String        @default("[]")
+  // Baseline
+  baseline              Baseline?
 }
 model TestVariation {
-  id           String    @default(uuid()) @id
+  id           String     @default(uuid()) @id
   name         String
   browser      String?
   device       String?
   os           String?
   viewport     String?
   baselineName String?
-  ignoreAreas  String    @default("[]")
+  ignoreAreas  String     @default("[]")
   projectId    String
-  project      Project   @relation(fields: [projectId], references: [id])
+  project      Project    @relation(fields: [projectId], references: [id])
   testRuns     TestRun[]
-  updatedAt    DateTime  @updatedAt
-  createdAt    DateTime  @default(now())
+  baselines    Baseline[]
+  updatedAt    DateTime   @updatedAt
+  createdAt    DateTime   @default(now())
 }
+model Baseline {
+  id              String        @default(uuid()) @id
+  baselineName    String
+  testVariationId String
+  testVariation   TestVariation @relation(fields: [testVariationId], references: [id])
+  testRunId       String?
+  testRun         TestRun?      @relation(fields: [testRunId], references: [id])
+  updatedAt       DateTime      @updatedAt
+  createdAt       DateTime      @default(now())
+}
+
 model User {
   id        String   @default(uuid()) @id
   email     String   @unique
   password  String
```


